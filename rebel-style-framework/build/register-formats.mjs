import fs from 'fs';

/**
 * This custom format creates CSS classes that map an old class name
 * to a new one that uses CSS variables generated by Style Dictionary.
 * It reads a mapping file to determine which classes to generate.
 *
 * Example Output:
 * .old-class-name {
 *   background-color: var(--component-button-primary-background);
 * }
 */
export default function registerFormats(StyleDictionary) {
  StyleDictionary.registerFormat({
    name: 'css/classes-adapter',
    format: function({ dictionary, options }) {
      // The mapFile path is passed from the config.json options
      const { mapFile } = options;
      if (!mapFile || !fs.existsSync(mapFile)) {
        console.warn(`Warning: Mapping file not found at ${mapFile}. Cannot generate adapter classes.`);
        return '';
      }

      const mapping = JSON.parse(fs.readFileSync(mapFile, 'utf-8'));
      let output = '/* Adapter classes to map old class names to new token variables */\n';

      // This is a placeholder for the logic that would iterate through the mapping
      // and generate the appropriate CSS. You would need to implement this based on your mapping file's structure.
      output += `/* TODO: Implement class generation based on ${mapFile} */\n`;

      return output;
    }
  });
}